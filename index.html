<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Particle Persona Quiz: Discover Your Subatomic Self</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div id="quiz-container">
        <div id="home-page">
            <h1>Particle Persona Quiz:<br>Discover Your Subatomic Self</h1>
            <p>Ever wondered if you're more of a quirky quark or a noble neutrino? Are you as elusive as a neutrino or
                as influential as a Higgs boson? Take this quiz to uncover your subatomic alter ego.</p>
            <div id="particle-carousel">
                <div class="carousel-inner">
                    <img src="particles/P01.png" alt="Particle 1" class="particle-icon">
                    <img src="particles/P02.png" alt="Particle 2" class="particle-icon">
                    <img src="particles/P03.png" alt="Particle 3" class="particle-icon">
                    <img src="particles/P04.png" alt="Particle 4" class="particle-icon">
                    <img src="particles/P05.png" alt="Particle 5" class="particle-icon">
                    <img src="particles/P06.png" alt="Particle 6" class="particle-icon">
                    <img src="particles/P07.png" alt="Particle 7" class="particle-icon">
                    <img src="particles/P08.png" alt="Particle 8" class="particle-icon">
                    <img src="particles/P09.png" alt="Particle 9" class="particle-icon">
                    <img src="particles/P10.png" alt="Particle 10" class="particle-icon">
                    <img src="particles/P11.png" alt="Particle 11" class="particle-icon">
                    <img src="particles/P12.png" alt="Particle 12" class="particle-icon">
                    <img src="particles/P13.png" alt="Particle 13" class="particle-icon">
                    <img src="particles/P14.png" alt="Particle 14" class="particle-icon">
                    <img src="particles/P15.png" alt="Particle 15" class="particle-icon">
                    <img src="particles/P16.png" alt="Particle 16" class="particle-icon">
                </div>
            </div>
            <p><strong>Warning:</strong> <em>results may be subject to quantum uncertainty!</em></p>
            <button id="start-quiz">Let's Begin!</button>
        </div>

        <div id="question-page" style="display: none;">
            <h2 id="question-text"></h2>
            <div id="answer-buttons"></div>
            <div id="progress-container">
                <div id="progress-bar"></div>
            </div>
            <div id="progress-text">Question 1 of 50</div>
        </div>

        <div id="results-page" style="display: none;">
            <h2>Your Particle Persona Is:</h2>
            <img id="result-image" src="" alt="Your Particle Persona">
            <p id="result-description"></p>
           <!--<p id="mbti-type"></p>-->> 
            <button id="restart-quiz">Try Again</button>
            <button id="save-to-file">Save Results</button>
            <button id="share-results">Share</button>
        </div>
    </div>

    <script src="questions.js"></script>
    <script>
        const particlePersonas = {
            "P01": { name: "Anti-down Quark", mbti: "ISTJ" },
            "P10": { name: "Anti-up Quark", mbti: "ESTJ" },
            "P09": { name: "Antimuon", mbti: "ESTP" },
            "P08": { name: "Axion", mbti: "INTP" },
            "P03": { name: "Down Quark", mbti: "ISFJ" },
            "P04": { name: "Electron", mbti: "ISFP" },
            "P14": { name: "Electron Antineutrino", mbti: "ENFJ" },
            "P13": { name: "Electron Neutrino", mbti: "ENFP" },
            "P07": { name: "Gravitino", mbti: "INTJ" },
            "P05": { name: "Higgs Boson", mbti: "INFJ" },
            "P16": { name: "Muon", mbti: "ENTJ" },
            "P02": { name: "Neutralino", mbti: "ISTP" },
            "P11": { name: "Positron", mbti: "ESFP" },
            "P15": { name: "Sterile Neutrino", mbti: "ENTP" },
            "P12": { name: "Up Quark", mbti: "ESFJ" },
            "P06": { name: "WIMP", mbti: "INFP" }
        };

        const particleIcons = [
            'P01.png', 'P02.png', 'P03.png', 'P04.png', 'P05.png', 'P06.png', 'P07.png', 'P08.png',
            'P09.png', 'P10.png', 'P11.png', 'P12.png', 'P13.png', 'P14.png', 'P15.png', 'P16.png'
        ];

        let currentQuestion = 0;
        const totalQuestions = 50;
        let mbtiScores = {
            E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0
        };

        document.getElementById('start-quiz').addEventListener('click', startQuiz);
        document.getElementById('restart-quiz').addEventListener('click', restartQuiz);

        function initializeCarousel() {
            const carousel = document.getElementById('particle-carousel');
            const icons = carousel.querySelectorAll('.particle-icon');
            const carouselWidth = carousel.offsetWidth;
            const iconWidth = 80;
            const visibleWidth = carouselWidth - 120;
            const spacing = (visibleWidth - (4 * iconWidth)) / 3;

            icons.forEach((icon, index) => {
                const initialLeft = -iconWidth + (index * (iconWidth + spacing));
                icon.style.left = `${initialLeft}px`;
            });
        }

        function animateCarousel() {
            const carousel = document.querySelector('.carousel-inner');
            const iconWidth = 80; // Width of each icon
            const totalIcons = 16; // Number of unique icons
            let position = 0;

            function step() {
                position -= .33; // Move 1 pixel to the left each frame
                if (position <= -iconWidth * totalIcons) {
                    position += iconWidth * totalIcons; // Reset position seamlessly
                    carousel.style.transition = 'none';
                    carousel.style.transform = `translateX(${position}px)`;
                    carousel.offsetHeight; // Trigger reflow
                    carousel.style.transition = 'transform 0.05s linear';
                }
                carousel.style.transform = `translateX(${position}px)`;
                requestAnimationFrame(step);
            }

            requestAnimationFrame(step);
        }

        document.addEventListener('DOMContentLoaded', animateCarousel);

        function startQuiz() {
            document.getElementById('home-page').style.display = 'none';
            document.getElementById('question-page').style.display = 'block';
            showQuestion(currentQuestion);
            updateProgressBar();
        }

        function showQuestion(index) {
            const question = questions[index];
            document.getElementById('question-text').textContent = question.question;
            const answerButtons = document.getElementById('answer-buttons');
            answerButtons.innerHTML = '';
            question.answers.forEach(answer => {
                const button = document.createElement('button');
                button.textContent = answer.text;
                button.addEventListener('click', () => selectAnswer(answer));
                answerButtons.appendChild(button);
            });
            updateProgressBar();
        }

        function selectAnswer(answer) {
            answer.types.forEach(type => {
                if (type in mbtiScores) {
                    mbtiScores[type]++;
                }
            });
            document.querySelectorAll('#answer-buttons button').forEach(button => {
                button.disabled = true;
            });

            setTimeout(() => {
                currentQuestion++;
                if (currentQuestion < questions.length) {
                    showQuestion(currentQuestion);
                } else {
                    showResults();
                }
                updateProgressBar();
            }, 100);
        }

        function updateProgressBar() {
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            const progress = (currentQuestion / totalQuestions) * 100;

            progressBar.style.width = `${progress}%`;
            progressText.textContent = `Question ${currentQuestion + 1} of ${totalQuestions}`;
        }

        function determineMBTIType() {
            const type = [
                mbtiScores.E > mbtiScores.I ? 'E' : 'I',
                mbtiScores.S > mbtiScores.N ? 'S' : 'N',
                mbtiScores.T > mbtiScores.F ? 'T' : 'F',
                mbtiScores.J > mbtiScores.P ? 'J' : 'P'
            ].join('');
            return type;
        }

        function getParticlePersonaByMBTI(mbtiType) {
            return Object.entries(particlePersonas).find(([_, value]) => value.mbti === mbtiType);
        }

        function showResults() {
            document.getElementById('question-page').style.display = 'none';
            document.getElementById('results-page').style.display = 'block';
            
            const mbtiType = determineMBTIType();
            const [particleKey, particleInfo] = getParticlePersonaByMBTI(mbtiType);
            
            document.getElementById('result-image').src = `profiles/${particleKey}.png`;
            document.getElementById('result-description').textContent = `Your Particle Persona is... ${particleInfo.name}!`;
            document.getElementById('mbti-type').textContent = `Your MBTI type is ${mbtiType}`;
        }

        function restartQuiz() {
            currentQuestion = 0;
            mbtiScores = Object.fromEntries(Object.keys(mbtiScores).map(key => [key, 0]));
            document.getElementById('results-page').style.display = 'none';
            document.getElementById('home-page').style.display = 'block';
            updateProgressBar();
        }

        document.getElementById('save-to-file').addEventListener('click', function () {
            const resultImage = document.getElementById('result-image');
            const imageUrl = resultImage.src;

            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = imageUrl;
            a.download = 'Particle_Persona_Image.png';

            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        });

        document.getElementById('share-results').addEventListener('click', async function () {
            const resultImage = document.getElementById('result-image');
            const persona = document.querySelector('#result-description').innerText;
            const mbtiType = document.getElementById('mbti-type').innerText;
            const shareText = `${persona}\n${mbtiType}\nCheck it out at: ${window.location.href}`;

            try {
                if (navigator.share) {
                    await navigator.share({
                        title: 'My Particle Persona Quiz Results',
                        text: shareText,
                        url: window.location.href
                    });
                    console.log('Thanks for sharing!');
                } else {
                    throw new Error('Web Share API not supported');
                }
            } catch (error) {
                console.error('Error sharing:', error);
                
                try {
                    await navigator.clipboard.writeText(shareText);
                    alert('Share text copied to clipboard! You can now paste it wherever you want to share.');
                } catch (clipboardError) {
                    console.error('Clipboard write failed:', clipboardError);
                    alert('Unable to share. Please manually copy this text:\n\n' + shareText);
                }
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            initializeCarousel();
            setTimeout(animateCarousel, 100);
        });
    </script>
</body>

</html>